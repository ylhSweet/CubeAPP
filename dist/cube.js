!function(){"use strict";const t=(()=>{let t=0;return new class{constructor(){this.ids=[],this.animations={},this.update=this.update.bind(this),this.raf=0,this.time=0}update(){const t=performance.now(),e=t-this.time;this.time=t;let s=this.ids.length;for(this.raf=s?requestAnimationFrame(this.update):0;s--;)this.animations[this.ids[s]]&&this.animations[this.ids[s]].update(e)}add(e){e.id=t++,this.ids.push(e.id),this.animations[e.id]=e,0===this.raf&&(this.time=performance.now(),this.raf=requestAnimationFrame(this.update))}remove(t){const e=this.ids.indexOf(t.id);e<0||(this.ids.splice(e,1),delete this.animations[t.id],t=null)}}})();class e{constructor(t){!0===t&&this.start()}start(){t.add(this)}stop(){t.remove(this)}update(t){}}class s extends e{constructor(t){super(!0),this.game=t,this.container=this.game.dom.game,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.container.appendChild(this.renderer.domElement),this.camera=new THREE.PerspectiveCamera(2,1,.1,1e4),this.stage={width:2,height:3},this.fov=10,this.createLights(),this.onResize=[],this.resize(),window.addEventListener("resize",(()=>this.resize()),!1)}update(){this.renderer.render(this.scene,this.camera)}resize(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.renderer.setSize(this.width,this.height),this.camera.fov=this.fov,this.camera.aspect=this.width/this.height;const t=this.stage.width/this.stage.height,e=this.fov*THREE.Math.DEG2RAD;let s=t<this.camera.aspect?this.stage.height/2/Math.tan(e/2):this.stage.width/this.camera.aspect/(2*Math.tan(e/2));s*=.5,this.camera.position.set(s,s,s),this.camera.lookAt(this.scene.position),this.camera.updateProjectionMatrix();const i=t<this.camera.aspect?this.height/100*t:this.width/100;document.documentElement.style.fontSize=i+"px",this.onResize&&this.onResize.forEach((t=>t()))}createLights(){this.lights={holder:new THREE.Object3D,ambient:new THREE.AmbientLight(16777215,.69),front:new THREE.DirectionalLight(16777215,.36),back:new THREE.DirectionalLight(16777215,.19)},this.lights.front.position.set(1.5,5,3),this.lights.back.position.set(-1.5,-5,-3),this.lights.holder.add(this.lights.ambient),this.lights.holder.add(this.lights.front),this.lights.holder.add(this.lights.back),this.scene.add(this.lights.holder)}}function i(t,e,s){var i,o,a;THREE.BufferGeometry.call(this),this.type="RoundedBoxGeometry",s=isNaN(s)?1:Math.max(1,Math.floor(s)),i=o=a=t,e*=t;var r=i/2-(e=Math.min(e,Math.min(i,Math.min(o,Math.min(a)))/2)),h=o/2-e,n=a/2-e;this.parameters={width:i,height:o,depth:a,radius:e,radiusSegments:s};var c=s+1,l=c*s+1<<3,m=new THREE.BufferAttribute(new Float32Array(3*l),3),u=new THREE.BufferAttribute(new Float32Array(3*l),3),d=[],g=[];new THREE.Vector3;var p,b,v,y,f=new THREE.Vector3,w=[],E=[],T=[],x=c*s,M=c*s+1;!function(){for(var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,-1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(-1,-1,1)],i=0;i<8;i++)d.push([]),g.push([]);for(var o=Math.PI/2,a=new THREE.Vector3(r,h,n),c=0;c<=s;c++){var l=c/s*o,m=Math.cos(l),u=Math.sin(l);if(c!=s)for(var p=0;p<=s;p++){var b=p/s*o;f.x=m*Math.cos(b),f.y=u,f.z=m*Math.sin(b);v=f.clone().multiplyScalar(e).add(a);d[0].push(v),w.push(v);y=f.clone().normalize();g[0].push(y),E.push(y)}else{f.set(0,1,0);var v=f.clone().multiplyScalar(e).add(a);d[0].push(v),w.push(v);var y=f.clone();g[0].push(y),E.push(y)}}for(var T=1;T<8;T++)for(i=0;i<d[0].length;i++){v=d[0][i].clone().multiply(t[T]);d[T].push(v),w.push(v);y=g[0][i].clone().multiply(t[T]);g[T].push(y),E.push(y)}}(),p=x,b=x+M,v=x+2*M,y=x+3*M,T.push(p),T.push(b),T.push(v),T.push(p),T.push(v),T.push(y),p=x+4*M,b=x+5*M,v=x+6*M,y=x+7*M,T.push(p),T.push(v),T.push(b),T.push(p),T.push(y),T.push(v),p=0,b=M,v=4*M,y=5*M,T.push(p),T.push(v),T.push(b),T.push(b),T.push(v),T.push(y),p=2*M,b=3*M,v=6*M,y=7*M,T.push(p),T.push(v),T.push(b),T.push(b),T.push(v),T.push(y),p=s,b=s+3*M,v=s+4*M,y=s+7*M,T.push(p),T.push(b),T.push(v),T.push(b),T.push(y),T.push(v),p=s+M,b=s+2*M,v=s+5*M,y=s+6*M,T.push(p),T.push(v),T.push(b),T.push(b),T.push(v),T.push(y),function(){for(var t=[!0,!1,!0,!1,!1,!0,!1,!0],e=c*(s-1),i=0;i<8;i++){for(var o=M*i,a=0;a<s-1;a++)for(var r=a*c,h=(a+1)*c,n=0;n<s;n++){var l=n+1,m=o+r+n,u=o+r+l,d=o+h+n,g=o+h+l;t[i]?(T.push(m),T.push(d),T.push(u),T.push(u),T.push(d),T.push(g)):(T.push(m),T.push(u),T.push(d),T.push(u),T.push(g),T.push(d))}for(n=0;n<s;n++){m=o+e+n,u=o+e+n+1,d=o+x;t[i]?(T.push(m),T.push(d),T.push(u)):(T.push(m),T.push(u),T.push(d))}}}(),function(){for(var t=0;t<4;t++)for(var e=t*M,i=4*M+e,o=!0&t,a=0;a<s;a++){var r=a+1,h=e+a,n=e+r,c=i+a,l=i+r;o?(T.push(h),T.push(c),T.push(n),T.push(n),T.push(c),T.push(l)):(T.push(h),T.push(n),T.push(c),T.push(n),T.push(l),T.push(c))}}(),function(){for(var t=s-1,e=[0,1,4,5],i=[3,2,7,6],o=[0,1,1,0],a=0;a<4;a++)for(var r=e[a]*M,h=i[a]*M,n=0;n<=t;n++){var l=r+s+n*c,m=r+(n!=t?s+(n+1)*c:M-1),u=h+s+n*c,d=h+(n!=t?s+(n+1)*c:M-1);o[a]?(T.push(l),T.push(u),T.push(m),T.push(m),T.push(u),T.push(d)):(T.push(l),T.push(m),T.push(u),T.push(m),T.push(d),T.push(u))}}(),function(){for(var t=[0,2,4,6],e=[1,3,5,7],i=0;i<4;i++)for(var o=M*t[i],a=M*e[i],r=1>=i,h=0;h<s;h++){var n=h*c,l=(h+1)*c,m=o+n,u=o+l,d=a+n,g=a+l;r?(T.push(m),T.push(d),T.push(u),T.push(u),T.push(d),T.push(g)):(T.push(m),T.push(u),T.push(d),T.push(u),T.push(g),T.push(d))}}();for(var S=0,z=0;z<w.length;z++)m.setXYZ(S,w[z].x,w[z].y,w[z].z),u.setXYZ(S,E[z].x,E[z].y,E[z].z),S++;this.setIndex(new THREE.BufferAttribute(new Uint16Array(T),1)),this.addAttribute("position",m),this.addAttribute("normal",u)}i.prototype=Object.create(THREE.BufferGeometry.prototype),i.constructor=i;class o{constructor(t){this.game=t,this.size=3,this.geometry={pieceCornerRadius:.01,edgeCornerRoundness:0,edgeScale:.9,edgeDepth:.001},this.holder=new THREE.Object3D,this.object=new THREE.Object3D,this.animator=new THREE.Object3D,this.holder.add(this.animator),this.animator.add(this.object),this.game.world.scene.add(this.holder)}init(){this.cubes=[],this.object.children=[],this.object.add(this.game.controls.group),2===this.size?this.scale=1.25:3===this.size?this.scale=1:this.size>3&&(this.scale=3/this.size),this.object.scale.set(this.scale,this.scale,this.scale);const t=2===this.size?.825:1;this.game.controls.edges.scale.set(t,t,t),this.generatePositions(),this.generateModel(),this.pieces.forEach((t=>{this.cubes.push(t.userData.cube),this.object.add(t)})),this.holder.traverse((t=>{t.frustumCulled&&(t.frustumCulled=!1)})),this.updateColors(this.game.themes.getColors()),this.sizeGenerated=this.size}resize(t=!1){(this.size!==this.sizeGenerated||t)&&(this.size=this.game.preferences.ranges.size.value,this.reset(),this.init(),this.game.saved=!1,this.game.timer.reset(),this.game.storage.clearGame())}reset(){this.game.controls.edges.rotation.set(0,0,0),this.holder.rotation.set(0,0,0),this.object.rotation.set(0,0,0),this.animator.rotation.set(0,0,0)}generatePositions(){const t=this.size-1,e=this.size%2!=0?0-Math.floor(this.size/2):.5-this.size/2;let s,i,o;for(this.positions=[],s=0;s<this.size;s++)for(i=0;i<this.size;i++)for(o=0;o<this.size;o++){let a=new THREE.Vector3(e+s,e+i,e+o),r=[];0==s&&r.push(0),s==t&&r.push(1),0==i&&r.push(2),i==t&&r.push(3),0==o&&r.push(4),o==t&&r.push(5),a.edges=r,this.positions.push(a)}}generateModel(){this.pieces=[],this.edges=[];const t=1/3,e=new THREE.MeshBasicMaterial,s=new THREE.Mesh(new i(t,this.geometry.pieceCornerRadius,3),e.clone()),o=function(t,e,s){var i,o,a,r;i=o=-t/2,a=r=t,e*=t;const h=new THREE.Shape;return h.moveTo(i,o+e),h.lineTo(i,o+r-e),h.quadraticCurveTo(i,o+r,i+e,o+r),h.lineTo(i+a-e,o+r),h.quadraticCurveTo(i+a,o+r,i+a,o+r-e),h.lineTo(i+a,o+e),h.quadraticCurveTo(i+a,o,i+a-e,o),h.lineTo(i+e,o),h.quadraticCurveTo(i,o,i,o+e),new THREE.ExtrudeBufferGeometry(h,{depth:s,bevelEnabled:!1,curveSegments:12})}(t,this.geometry.edgeCornerRoundness,this.geometry.edgeDepth);this.positions.forEach(((i,a)=>{const r=new THREE.Object3D,h=s.clone(),n=[];r.position.copy(i.clone().divideScalar(3)),r.add(h),r.name=a,r.edgesName="",i.edges.forEach((s=>{const i=new THREE.Mesh(o,e.clone()),a=["L","R","D","U","B","F"][s],h=t/2;i.position.set(h*[-1,1,0,0,0,0][s],h*[0,0,-1,1,0,0][s],h*[0,0,0,0,-1,1][s]),i.rotation.set(Math.PI/2*[0,0,1,-1,0,0][s],Math.PI/2*[-1,1,0,0,2,0][s],0),i.scale.set(this.geometry.edgeScale,this.geometry.edgeScale,this.geometry.edgeScale),i.name=a,r.add(i),n.push(a),this.edges.push(i)})),r.userData.edges=n,r.userData.cube=h,r.userData.start={position:r.position.clone(),rotation:r.rotation.clone()},this.pieces.push(r)}))}updateColors(t){"object"!=typeof this.pieces&&"object"!=typeof this.edges||(this.pieces.forEach((e=>e.userData.cube.material.color.setHex(t.P))),this.edges.forEach((e=>e.material.color.setHex(t[e.name]))))}loadFromData(t){this.size=t.size,this.reset(),this.init(),this.pieces.forEach((e=>{const s=t.names.indexOf(e.name),i=t.positions[s],o=t.rotations[s];e.position.set(i.x,i.y,i.z),e.rotation.set(o.x,o.y,o.z)}))}}const a={In:t=>(t=Math.round(t||1),e=>Math.pow(e,t)),Out:t=>(t=Math.round(t||1),e=>1-Math.abs(Math.pow(e-1,t))),InOut:t=>(t=Math.round(t||1),e=>e<.5?Math.pow(2*e,t)/2:(1-Math.abs(Math.pow(2*e-1-1,t)))/2+.5)},r={In:()=>t=>1+Math.sin(Math.PI/2*t-Math.PI/2),Out:()=>t=>Math.sin(Math.PI/2*t),InOut:()=>t=>(1+Math.sin(Math.PI*t-Math.PI/2))/2},h={Out:t=>(t=t||1.70158,e=>(e-=1)*e*((t+1)*e+t)+1),In:t=>(t=t||1.70158,e=>e*e*((t+1)*e-t))},n={Out:(t,e)=>{let s=2*Math.PI,i=t>=1?t:1,o=(e||.3)/(t<1?t:1),a=o/s*(Math.asin(1/i)||0);return o=s/o,t=>i*Math.pow(2,-10*t)*Math.sin((t-a)*o)+1}};class c extends e{constructor(t){super(!1),this.duration=t.duration||500,this.easing=t.easing||(t=>t),this.onUpdate=t.onUpdate||(()=>{}),this.onComplete=t.onComplete||(()=>{}),this.delay=t.delay||!1,this.yoyo=!t.yoyo&&null,this.progress=0,this.value=0,this.delta=0,this.getFromTo(t),this.delay?setTimeout((()=>super.start()),this.delay):super.start(),this.onUpdate(this)}update(t){const e=1*this.value,s=!0===this.yoyo?-1:1;this.progress+=t/this.duration*s,this.value=this.easing(this.progress),this.delta=this.value-e,null!==this.values&&this.updateFromTo(),null!==this.yoyo?this.updateYoyo():this.progress<=1?this.onUpdate(this):(this.progress=1,this.value=1,this.onUpdate(this),this.onComplete(this),super.stop())}updateYoyo(){(this.progress>1||this.progress<0)&&(this.value=this.progress=this.progress>1?1:0,this.yoyo=!this.yoyo),this.onUpdate(this)}updateFromTo(){this.values.forEach((t=>{this.target[t]=this.from[t]+(this.to[t]-this.from[t])*this.value}))}getFromTo(t){t.target&&t.to?(this.target=t.target||null,this.from=t.from||{},this.to=t.to||null,this.values=[],Object.keys(this.from).length<1&&Object.keys(this.to).forEach((t=>{this.from[t]=this.target[t]})),Object.keys(this.to).forEach((t=>{this.values.push(t)}))):this.values=null}}window.addEventListener("touchmove",(()=>{})),document.addEventListener("touchmove",(t=>{t.preventDefault()}),{passive:!1});class l{constructor(t,e){return this.position={current:new THREE.Vector2,start:new THREE.Vector2,delta:new THREE.Vector2,old:new THREE.Vector2,drag:new THREE.Vector2},this.options=Object.assign({calcDelta:!1},e||{}),this.element=t,this.touch=null,this.drag={start:t=>{"mousedown"==t.type&&1!=t.which||"touchstart"==t.type&&t.touches.length>1||(this.getPositionCurrent(t),this.options.calcDelta&&(this.position.start=this.position.current.clone(),this.position.delta.set(0,0),this.position.drag.set(0,0)),this.touch="touchstart"==t.type,this.onDragStart(this.position),window.addEventListener(this.touch?"touchmove":"mousemove",this.drag.move,!1),window.addEventListener(this.touch?"touchend":"mouseup",this.drag.end,!1))},move:t=>{this.options.calcDelta&&(this.position.old=this.position.current.clone()),this.getPositionCurrent(t),this.options.calcDelta&&(this.position.delta=this.position.current.clone().sub(this.position.old),this.position.drag=this.position.current.clone().sub(this.position.start)),this.onDragMove(this.position)},end:t=>{this.getPositionCurrent(t),this.onDragEnd(this.position),window.removeEventListener(this.touch?"touchmove":"mousemove",this.drag.move,!1),window.removeEventListener(this.touch?"touchend":"mouseup",this.drag.end,!1)}},this.onDragStart=()=>{},this.onDragMove=()=>{},this.onDragEnd=()=>{},this.enable(),this}enable(){return this.element.addEventListener("touchstart",this.drag.start,!1),this.element.addEventListener("mousedown",this.drag.start,!1),this}disable(){return this.element.removeEventListener("touchstart",this.drag.start,!1),this.element.removeEventListener("mousedown",this.drag.start,!1),this}getPositionCurrent(t){const e=t.touches?t.touches[0]||t.changedTouches[0]:t;this.position.current.set(e.pageX,e.pageY)}convertPosition(t){return t.x=t.x/this.element.offsetWidth*2-1,t.y=-(t.y/this.element.offsetHeight*2-1),t}}class m{constructor(t){this.game=t,this.flipConfig=0,this.flipEasings=[a.Out(3),r.Out(),h.Out(1.5)],this.flipSpeeds=[125,200,300],this.raycaster=new THREE.Raycaster;const e=new THREE.MeshBasicMaterial({depthWrite:!1,transparent:!0,opacity:0,color:13311});this.group=new THREE.Object3D,this.group.name="controls",this.game.cube.object.add(this.group),this.helper=new THREE.Mesh(new THREE.PlaneBufferGeometry(200,200),e.clone()),this.helper.rotation.set(0,Math.PI/4,0),this.game.world.scene.add(this.helper),this.edges=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),e.clone()),this.game.world.scene.add(this.edges),this.onSolved=()=>{},this.onMove=()=>{},this.momentum=[],this.scramble=null,this.state=0,this.enabled=!1,this.initDraggable()}enable(){this.draggable.enable(),this.enabled=!0}disable(){this.draggable.disable(),this.enabled=!1}initDraggable(){this.draggable=new l(this.game.dom.game),this.draggable.onDragStart=t=>{if(null!==this.scramble)return;if(1===this.state||2===this.state)return;this.gettingDrag=3===this.state;const e=this.getIntersect(t.current,this.edges,!1);!1!==e&&(this.dragIntersect=this.getIntersect(t.current,this.game.cube.cubes,!0)),!1!==e&&!1!==this.dragIntersect?(this.dragNormal=e.face.normal.round(),this.flipType="layer",this.attach(this.helper,this.edges),this.helper.rotation.set(0,0,0),this.helper.position.set(0,0,0),this.helper.lookAt(this.dragNormal),this.helper.translateZ(.5),this.helper.updateMatrixWorld(),this.detach(this.helper,this.edges)):(this.dragNormal=new THREE.Vector3(0,0,1),this.flipType="cube",this.helper.position.set(0,0,0),this.helper.rotation.set(0,Math.PI/4,0),this.helper.updateMatrixWorld());let s=this.getIntersect(t.current,this.helper,!1);!1!==s&&(this.dragCurrent=this.helper.worldToLocal(s.point),this.dragTotal=new THREE.Vector3,this.state=0===this.state?1:this.state)},this.draggable.onDragMove=t=>{if(null!==this.scramble)return;if(0===this.state||3===this.state&&!1===this.gettingDrag)return;const e=this.getIntersect(t.current,this.helper,!1);if(!1===e)return;const s=this.helper.worldToLocal(e.point.clone());if(this.dragDelta=s.clone().sub(this.dragCurrent).setZ(0),this.dragTotal.add(this.dragDelta),this.dragCurrent=s,this.addMomentumPoint(this.dragDelta),1===this.state&&this.dragTotal.length()>.05){if(this.dragDirection=this.getMainAxis(this.dragTotal),"layer"===this.flipType){const t=new THREE.Vector3;t[this.dragDirection]=1;const e=this.helper.localToWorld(t).sub(this.helper.position),s=this.edges.worldToLocal(e).round();this.flipAxis=s.cross(this.dragNormal).negate(),this.selectLayer(this.getLayer(!1))}else{const e="x"!=this.dragDirection?"y"==this.dragDirection&&t.current.x>this.game.world.width/2?"z":"x":"y";this.flipAxis=new THREE.Vector3,this.flipAxis[e]=1*("x"==e?-1:1)}this.flipAngle=0,this.state=2}else if(2===this.state){const t=this.dragDelta[this.dragDirection];"layer"===this.flipType?(this.group.rotateOnAxis(this.flipAxis,t),this.flipAngle+=t):(this.edges.rotateOnWorldAxis(this.flipAxis,t),this.game.cube.object.rotation.copy(this.edges.rotation),this.flipAngle+=t)}},this.draggable.onDragEnd=t=>{if(null!==this.scramble)return;if(2!==this.state)return this.gettingDrag=!1,void(this.state=0);this.state=3;const e=this.getMomentum()[this.dragDirection],s=(Math.abs(e)>.05&&Math.abs(this.flipAngle)<Math.PI/2?this.roundAngle(this.flipAngle+Math.sign(this.flipAngle)*(Math.PI/4)):this.roundAngle(this.flipAngle))-this.flipAngle;"layer"===this.flipType?this.rotateLayer(s,!1,(t=>{this.game.storage.saveGame(),this.state=this.gettingDrag?1:0,this.gettingDrag=!1,this.checkIsSolved()})):this.rotateCube(s,(()=>{this.state=this.gettingDrag?1:0,this.gettingDrag=!1}))}}rotateLayer(t,e,s){const i=e?0:this.flipConfig,o=this.flipEasings[i],a=this.flipSpeeds[i],r=2==i?this.bounceCube():()=>{};this.rotationTween=new c({easing:o,duration:a,onUpdate:e=>{let s=e.delta*t;this.group.rotateOnAxis(this.flipAxis,s),r(e.value,s,t)},onComplete:()=>{e||this.onMove();const t=this.flipLayer.slice(0);this.game.cube.object.rotation.setFromVector3(this.snapRotation(this.game.cube.object.rotation.toVector3())),this.group.rotation.setFromVector3(this.snapRotation(this.group.rotation.toVector3())),this.deselectLayer(this.flipLayer),s(t)}})}bounceCube(){let t=!0;return(e,s,i)=>{e>=1&&(t&&(s=(e-1)*i,t=!1),this.game.cube.object.rotateOnAxis(this.flipAxis,s))}}rotateCube(t,e){const s=this.flipConfig,i=[a.Out(4),r.Out(),h.Out(2)][s],o=[100,150,350][s];this.rotationTween=new c({easing:i,duration:o,onUpdate:e=>{this.edges.rotateOnWorldAxis(this.flipAxis,e.delta*t),this.game.cube.object.rotation.copy(this.edges.rotation)},onComplete:()=>{this.edges.rotation.setFromVector3(this.snapRotation(this.edges.rotation.toVector3())),this.game.cube.object.rotation.copy(this.edges.rotation),e()}})}selectLayer(t){this.group.rotation.set(0,0,0),this.movePieces(t,this.game.cube.object,this.group),this.flipLayer=t}deselectLayer(t){this.movePieces(t,this.group,this.game.cube.object),this.flipLayer=null}movePieces(t,e,s){e.updateMatrixWorld(),s.updateMatrixWorld(),t.forEach((t=>{const i=this.game.cube.pieces[t];i.applyMatrix(e.matrixWorld),e.remove(i),i.applyMatrix((new THREE.Matrix4).getInverse(s.matrixWorld)),s.add(i)}))}getLayer(t){const e={2:6,3:3,4:4,5:3}[this.game.cube.size],s=[];let i;if(!1===t){const s=this.dragIntersect.object.parent;i=this.getMainAxis(this.flipAxis),t=s.position.clone().multiplyScalar(e).round()}else i=this.getMainAxis(t);return this.game.cube.pieces.forEach((o=>{o.position.clone().multiplyScalar(e).round()[i]==t[i]&&s.push(o.name)})),s}keyboardMove(t,e,s){if(0===this.state&&!0===this.enabled)if("LAYER"===t){const t=this.getLayer(e.position);this.flipAxis=new THREE.Vector3,this.flipAxis[e.axis]=1,this.state=2,this.selectLayer(t),this.rotateLayer(e.angle,!1,(t=>{this.game.storage.saveGame(),this.state=0,this.checkIsSolved()}))}else"CUBE"===t&&(this.flipAxis=new THREE.Vector3,this.flipAxis[e.axis]=1,this.state=2,this.rotateCube(e.angle,(()=>{this.state=0})))}scrambleCube(){null==this.scramble&&(this.scramble=this.game.scrambler,this.scramble.callback="function"!=typeof callback?()=>{}:callback);const t=this.scramble.converted,e=t[0],s=this.getLayer(e.position);this.flipAxis=new THREE.Vector3,this.flipAxis[e.axis]=1,this.selectLayer(s),this.rotateLayer(e.angle,!0,(()=>{t.shift(),t.length>0?this.scrambleCube():(this.scramble=null,this.game.storage.saveGame())}))}getIntersect(t,e,s){this.raycaster.setFromCamera(this.draggable.convertPosition(t.clone()),this.game.world.camera);const i=s?this.raycaster.intersectObjects(e):this.raycaster.intersectObject(e);return i.length>0&&i[0]}getMainAxis(t){return Object.keys(t).reduce(((e,s)=>Math.abs(t[e])>Math.abs(t[s])?e:s))}detach(t,e){t.applyMatrix(e.matrixWorld),e.remove(t),this.game.world.scene.add(t)}attach(t,e){t.applyMatrix((new THREE.Matrix4).getInverse(e.matrixWorld)),this.game.world.scene.remove(t),e.add(t)}addMomentumPoint(t){const e=Date.now();this.momentum=this.momentum.filter((t=>e-t.time<500)),!1!==t&&this.momentum.push({delta:t,time:e})}getMomentum(){const t=this.momentum.length,e=new THREE.Vector2;return this.addMomentumPoint(!1),this.momentum.forEach(((s,i)=>{e.add(s.delta.multiplyScalar(i/t))})),e}roundAngle(t){const e=Math.PI/2;return Math.sign(t)*Math.round(Math.abs(t)/e)*e}snapRotation(t){return t.set(this.roundAngle(t.x),this.roundAngle(t.y),this.roundAngle(t.z))}checkIsSolved(){performance.now();let t=!0;const e={"x-":[],"x+":[],"y-":[],"y+":[],"z-":[],"z+":[]};this.game.cube.edges.forEach((t=>{const s=t.parent.localToWorld(t.position.clone()).sub(this.game.cube.object.position),i=this.getMainAxis(s),o=s.multiplyScalar(2).round()[i]<1?"-":"+";e[i+o].push(t.name)})),Object.keys(e).forEach((s=>{e[s].every((t=>t===e[s][0]))||(t=!1)})),t&&this.onSolved()}}class u{constructor(t){this.game=t,this.dificulty=0,this.scrambleLength={2:[7,9,11],3:[20,25,30],4:[30,40,50],5:[40,60,80]},this.moves=[],this.conveted=[],this.pring=""}scramble(t){let e=0;if(this.moves=void 0!==t?t.split(" "):[],this.moves.length<1){const s=this.scrambleLength[this.game.cube.size][this.dificulty],i=this.game.cube.size<4?"UDLRFB":"UuDdLlRrFfBb",o=["","'","2"],a=void 0===t?s:t;for(;e<a;){const t=i[Math.floor(Math.random()*i.length)]+o[Math.floor(3*Math.random())];e>0&&t.charAt(0)==this.moves[e-1].charAt(0)||(e>1&&t.charAt(0)==this.moves[e-2].charAt(0)||(this.moves.push(t),e++))}}return this.callback=()=>{},this.convert(),this.print=this.moves.join(" "),this}convert(t){this.converted=[],this.moves.forEach((t=>{const e=this.convertMove(t),s=t.charAt(1);this.converted.push(e),"2"==s&&this.converted.push(e)}))}convertMove(t){const e=t.charAt(0),s=t.charAt(1),i={D:"y",U:"y",L:"x",R:"x",F:"z",B:"z"}[e.toUpperCase()];let o={D:-1,U:1,L:-1,R:1,F:1,B:-1}[e.toUpperCase()];this.game.cube.size>3&&e!==e.toLowerCase()&&(o*=2);const a=new THREE.Vector3;a[{D:"y",U:"y",L:"x",R:"x",F:"z",B:"z"}[e.toUpperCase()]]=o;return{position:a,axis:i,angle:Math.PI/2*-o*("'"==s?-1:1),name:t}}}class d{constructor(t){this.game=t,this.tweens={},this.durations={},this.data={cubeY:-.2,cameraZoom:.85},this.activeTransitions=0}init(){this.game.controls.disable(),this.game.cube.object.position.y=this.data.cubeY,this.game.cube.animator.position.y=4,this.game.cube.animator.rotation.x=-Math.PI/3,this.game.world.camera.zoom=this.data.cameraZoom,this.game.world.camera.updateProjectionMatrix(),this.tweens.buttons={},this.tweens.timer=[],this.tweens.title=[],this.tweens.best=[],this.tweens.complete=[],this.tweens.prefs=[],this.tweens.theme=[],this.tweens.stats=[]}buttons(t,e){const s=(t,e)=>new c({target:t.style,duration:100,easing:e?a.Out(2):a.In(3),from:{opacity:e?0:1},to:{opacity:e?1:0},onUpdate:s=>{const i=e?1-s.value:s.value;t.style.transform=`translate3d(0, ${1.5*i}em, 0)`},onComplete:()=>t.style.pointerEvents=e?"all":"none"});e.forEach((t=>this.tweens.buttons[t]=s(this.game.dom.buttons[t],!1))),setTimeout((()=>t.forEach((t=>{this.tweens.buttons[t]=s(this.game.dom.buttons[t],!0)}))),e?500:0)}cube(t,e=!1){this.activeTransitions++;try{this.tweens.cube.stop()}catch(t){}const s=this.game.cube.animator.position.y,i=this.game.cube.animator.rotation.x;this.tweens.cube=new c({duration:t?1500:500,easing:t?n.Out(.8,.6):h.In(1),onUpdate:o=>{this.game.cube.animator.position.y=t?e?.9+3.5*(1-o.value):4*(1-o.value):s+4*o.value,this.game.cube.animator.rotation.x=t?(1-o.value)*Math.PI/3:i+o.value*-Math.PI/3}}),e&&(t?(this.game.world.camera.zoom=.75,this.game.world.camera.updateProjectionMatrix()):setTimeout((()=>{this.game.world.camera.zoom=this.data.cameraZoom,this.game.world.camera.updateProjectionMatrix()}),1500)),this.durations.cube=1500,setTimeout((()=>this.activeTransitions--),this.durations.cube)}float(){try{this.tweens.float.stop()}catch(t){}this.tweens.float=new c({duration:1500,easing:r.InOut(),yoyo:!0,onUpdate:t=>{this.game.cube.holder.position.y=.04*t.value-.02,this.game.cube.holder.rotation.x=.005-.01*t.value,this.game.cube.holder.rotation.z=-this.game.cube.holder.rotation.x,this.game.cube.holder.rotation.y=this.game.cube.holder.rotation.x,this.game.controls.edges.position.y=this.game.cube.holder.position.y+this.game.cube.object.position.y}})}zoom(t,e){this.activeTransitions++;const s=t?1:this.data.cameraZoom,i=e>0?Math.max(e,1500):1500,o=e>0?Math.round(i/1500):1,r=a.InOut(e>0?2:3);this.tweens.zoom=new c({target:this.game.world.camera,duration:i,easing:r,to:{zoom:s},onUpdate:()=>{this.game.world.camera.updateProjectionMatrix()}}),this.tweens.rotate=new c({target:this.game.cube.animator.rotation,duration:i,easing:r,to:{y:2*-Math.PI*o},onComplete:()=>{this.game.cube.animator.rotation.y=0}}),this.durations.zoom=i,setTimeout((()=>this.activeTransitions--),this.durations.zoom)}elevate(t){this.activeTransitions++,this.tweens.elevate=new c({target:this.game.cube.object.position,duration:t?1500:0,easing:a.InOut(3),to:{y:t?-.05:this.data.cubeY}}),this.durations.elevate=1500,setTimeout((()=>this.activeTransitions--),this.durations.elevate)}complete(t,e){this.activeTransitions++;const s=e?this.game.dom.texts.best:this.game.dom.texts.complete;null===s.querySelector("span i")&&s.querySelectorAll("span").forEach((t=>this.splitLetters(t)));const i=s.querySelectorAll(".icon, i");this.flipLetters(e?"best":"complete",i,t),s.style.opacity=1;const o=this.durations[e?"best":"complete"];t||setTimeout((()=>this.game.dom.texts.timer.style.transform=""),o),setTimeout((()=>this.activeTransitions--),o)}stats(t){t&&this.game.scores.calcStats(),this.activeTransitions++,this.tweens.stats.forEach((t=>{t.stop(),t=null}));let e=-1;const s=this.game.dom.stats.querySelectorAll(".stats"),i=t?a.Out(2):a.In(3);s.forEach(((s,o)=>{const a=o*(t?80:60);this.tweens.stats[e++]=new c({delay:a,duration:200,easing:i,onUpdate:e=>{const i=t?2*(1-e.value):e.value,o=t?e.value:1-e.value;s.style.transform=`translate3d(0, ${i}em, 0)`,s.style.opacity=o}})})),this.durations.stats=0,setTimeout((()=>this.activeTransitions--),this.durations.stats)}preferences(t){this.ranges(this.game.dom.prefs.querySelectorAll(".range"),"prefs",t)}theming(t){this.ranges(this.game.dom.theme.querySelectorAll(".range"),"prefs",t)}ranges(t,e,s){this.activeTransitions++,this.tweens[e].forEach((t=>{t.stop(),t=null}));const i=s?a.Out(2):a.In(3);let o=-1,r=0;t.forEach(((t,a)=>{const h=t.querySelector(".range__label"),n=t.querySelector(".range__track-line"),l=t.querySelector(".range__handle"),m=t.querySelectorAll(".range__list div"),u=a*(s?0:100);h.style.opacity=s?0:1,n.style.opacity=s?0:1,l.style.opacity=s?0:1,l.style.pointerEvents=s?"all":"none",this.tweens[e][o++]=new c({delay:u,duration:400,easing:i,onUpdate:t=>{const e=s?1-t.value:t.value,i=s?t.value:1-t.value;h.style.transform=`translate3d(0, ${e}em, 0)`,h.style.opacity=i}}),this.tweens[e][o++]=new c({delay:s?u+100:u,duration:400,easing:i,onUpdate:t=>{const e=s?1-t.value:t.value,i=s?t.value:1-t.value,o=i;n.style.transform=`translate3d(0, ${e}em, 0) scale3d(${i}, 1, 1)`,n.style.opacity=o}}),this.tweens[e][o++]=new c({delay:s?u+100:u,duration:400,easing:i,onUpdate:t=>{const e=s?1-t.value:t.value,i=1-e,o=.5+.5*i;l.style.transform=`translate3d(0, ${e}em, 0) scale3d(${o}, ${o}, ${o})`,l.style.opacity=i}}),m.forEach(((t,a)=>{t.style.opacity=s?0:1,this.tweens[e][o++]=new c({delay:s?u+200+50*a:u,duration:400,easing:i,onUpdate:e=>{const i=s?1-e.value:e.value,o=s?e.value:1-e.value;t.style.transform=`translate3d(0, ${i}em, 0)`,t.style.opacity=o}})})),r=m.length>r?m.length-1:r,t.style.opacity=1})),this.durations[e]=s?100*(t.length-1)+200+50*r+400:100*(t.length-1)+400,setTimeout((()=>this.activeTransitions--),this.durations[e])}title(t){this.activeTransitions++;const e=this.game.dom.texts.title;null===e.querySelector("span i")&&e.querySelectorAll("span").forEach((t=>this.splitLetters(t)));const s=e.querySelectorAll("i");this.flipLetters("title",s,t),e.style.opacity=1;const i=this.game.dom.texts.note;this.tweens.title[s.length]=new c({target:i.style,easing:r.InOut(),duration:t?800:400,yoyo:!!t||null,from:{opacity:t?0:parseFloat(getComputedStyle(i).opacity)},to:{opacity:t?1:0}}),setTimeout((()=>this.activeTransitions--),this.durations.title)}timer(t){this.activeTransitions++;const e=this.game.dom.texts.timer;e.style.opacity=0,this.game.timer.convert(),this.game.timer.setText(),this.splitLetters(e);const s=e.querySelectorAll("i");this.flipLetters("timer",s,t),e.style.opacity=1,setTimeout((()=>this.activeTransitions--),this.durations.timer)}splitLetters(t){const e=t.innerHTML;t.innerHTML="",e.split("").forEach((e=>{const s=document.createElement("i");s.innerHTML=e,t.appendChild(s)}))}flipLetters(t,e,s){try{this.tweens[t].forEach((t=>t.stop()))}catch(t){}e.forEach(((e,i)=>{e.style.opacity=s?0:1,this.tweens[t][i]=new c({easing:r.Out(),duration:s?800:400,delay:50*i,onUpdate:t=>{const i=s?-80*(1-t.value):80*t.value;e.style.transform=`rotate3d(0, 1, 0, ${i}deg)`,e.style.opacity=s?t.value:1-t.value}})})),this.durations[t]=50*(e.length-1)+(s?800:400)}}class g extends e{constructor(t){super(!1),this.game=t,this.reset()}start(t){this.startTime=t?Date.now()-this.deltaTime:Date.now(),this.deltaTime=0,this.converted=this.convert(),super.start()}reset(){this.startTime=0,this.currentTime=0,this.deltaTime=0,this.converted="0:00"}stop(){return this.currentTime=Date.now(),this.deltaTime=this.currentTime-this.startTime,this.convert(),super.stop(),{time:this.converted,millis:this.deltaTime}}update(){const t=this.converted;this.currentTime=Date.now(),this.deltaTime=this.currentTime-this.startTime,this.convert(),this.converted!=t&&(localStorage.setItem("theCube_time",this.deltaTime),this.setText())}convert(){const t=parseInt(this.deltaTime/1e3%60),e=parseInt(this.deltaTime/6e4);this.converted=e+":"+(t<10?"0":"")+t}setText(){this.game.dom.texts.timer.innerHTML=this.converted}}const p=['<div class="range">','<div class="range__label"></div>','<div class="range__track">','<div class="range__track-line"></div>','<div class="range__handle"><div></div></div>',"</div>",'<div class="range__list"></div>',"</div>"].join("\n");document.querySelectorAll("range").forEach((t=>{const e=document.createElement("div");e.innerHTML=p;const s=e.querySelector(".range"),i=s.querySelector(".range__label"),o=s.querySelector(".range__list");s.setAttribute("name",t.getAttribute("name")),i.innerHTML=t.getAttribute("title"),t.hasAttribute("color")&&(s.classList.add("range--type-color"),s.classList.add("range--color-"+t.getAttribute("name"))),t.hasAttribute("list")&&t.getAttribute("list").split(",").forEach((t=>{const e=document.createElement("div");e.innerHTML=t,o.appendChild(e)})),t.parentNode.replaceChild(s,t)}));class b{constructor(t,e){e=Object.assign({range:[0,1],value:0,step:0,onUpdate:()=>{},onComplete:()=>{}},e||{}),this.element=document.querySelector('.range[name="'+t+'"]'),this.track=this.element.querySelector(".range__track"),this.handle=this.element.querySelector(".range__handle"),this.list=[].slice.call(this.element.querySelectorAll(".range__list div")),this.value=e.value,this.min=e.range[0],this.max=e.range[1],this.step=e.step,this.onUpdate=e.onUpdate,this.onComplete=e.onComplete,this.setValue(this.value),this.initDraggable()}setValue(t){this.value=this.round(this.limitValue(t)),this.setHandlePosition()}initDraggable(){let t;this.draggable=new l(this.handle,{calcDelta:!0}),this.draggable.onDragStart=e=>{t=this.positionFromValue(this.value),this.handle.style.left=t+"px"},this.draggable.onDragMove=e=>{t=this.limitPosition(t+e.delta.x),this.value=this.round(this.valueFromPosition(t)),this.setHandlePosition(),this.onUpdate(this.value)},this.draggable.onDragEnd=t=>{this.onComplete(this.value)}}round(t){return this.step<1?t:Math.round((t-this.min)/this.step)*this.step+this.min}limitValue(t){const e=Math.max(this.max,this.min),s=Math.min(this.max,this.min);return Math.min(Math.max(t,s),e)}limitPosition(t){return Math.min(Math.max(t,0),this.track.offsetWidth)}percentsFromValue(t){return(t-this.min)/(this.max-this.min)}valueFromPosition(t){return this.min+(this.max-this.min)*(t/this.track.offsetWidth)}positionFromValue(t){return this.percentsFromValue(t)*this.track.offsetWidth}setHandlePosition(){this.handle.style.left=100*this.percentsFromValue(this.value)+"%"}}class v{constructor(t){this.game=t}init(){this.ranges={size:new b("size",{value:this.game.cube.size,range:[2,5],step:1,onUpdate:t=>{this.game.cube.size=t,this.game.preferences.ranges.scramble.list.forEach(((t,e)=>{t.innerHTML=this.game.scrambler.scrambleLength[this.game.cube.size][e]}))},onComplete:()=>this.game.storage.savePreferences()}),flip:new b("flip",{value:this.game.controls.flipConfig,range:[0,2],step:1,onUpdate:t=>{this.game.controls.flipConfig=t},onComplete:()=>this.game.storage.savePreferences()}),scramble:new b("scramble",{value:this.game.scrambler.dificulty,range:[0,2],step:1,onUpdate:t=>{this.game.scrambler.dificulty=t},onComplete:()=>this.game.storage.savePreferences()}),fov:new b("fov",{value:this.game.world.fov,range:[2,45],onUpdate:t=>{this.game.world.fov=t,this.game.world.resize()},onComplete:()=>this.game.storage.savePreferences()}),theme:new b("theme",{value:{cube:0,erno:1,dust:2,camo:3,rain:4}[this.game.themes.theme],range:[0,4],step:1,onUpdate:t=>{const e=["cube","erno","dust","camo","rain"][t];this.game.themes.setTheme(e)},onComplete:()=>this.game.storage.savePreferences()}),hue:new b("hue",{value:0,range:[0,360],onUpdate:t=>this.game.themeEditor.updateHSL(),onComplete:()=>this.game.storage.savePreferences()}),saturation:new b("saturation",{value:100,range:[0,100],onUpdate:t=>this.game.themeEditor.updateHSL(),onComplete:()=>this.game.storage.savePreferences()}),lightness:new b("lightness",{value:50,range:[0,100],onUpdate:t=>this.game.themeEditor.updateHSL(),onComplete:()=>this.game.storage.savePreferences()})},this.ranges.scramble.list.forEach(((t,e)=>{t.innerHTML=this.game.scrambler.scrambleLength[this.game.cube.size][e]}))}}class y{constructor(t){this.game=t,this.started=0,this.options={speed:{min:.0011,max:.0022},revolution:{min:.01,max:.05},size:{min:.1,max:.15},colors:[4303560,8571448,16772936,15677731,16747530]},this.geometry=new THREE.PlaneGeometry(1,1),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide}),this.holders=[new f(this.game,this,1,20),new f(this.game,this,-1,30)]}start(){this.started>0||this.holders.forEach((t=>{this.game.world.scene.add(t.holder),t.start(),this.started++}))}stop(){0!=this.started&&this.holders.forEach((t=>{t.stop((()=>{this.game.world.scene.remove(t.holder),this.started--}))}))}updateColors(t){this.holders.forEach((e=>{e.options.colors.forEach(((s,i)=>{e.options.colors[i]=t[["D","F","R","B","L"][i]]}))}))}}class f extends e{constructor(t,e,s,i){super(!1),this.game=t,this.parent=e,this.distanceFromCube=s,this.count=i,this.particles=[],this.holder=new THREE.Object3D,this.holder.rotation.copy(this.game.world.camera.rotation),this.object=new THREE.Object3D,this.holder.add(this.object),this.resizeViewport=this.resizeViewport.bind(this),this.game.world.onResize.push(this.resizeViewport),this.resizeViewport(),this.geometry=this.parent.geometry,this.material=this.parent.material,this.options=this.parent.options;let o=this.count;for(;o--;)this.particles.push(new w(this))}start(){this.time=performance.now(),this.playing=!0;let t=this.count;for(;t--;)this.particles[t].reset();super.start()}stop(t){this.playing=!1,this.completed=0,this.callback=t}reset(){super.stop(),this.callback()}update(){const t=performance.now(),e=t-this.time;this.time=t;let s=this.count;for(;s--;)this.particles[s].completed||this.particles[s].update(e);this.playing||this.completed!=this.count||this.reset()}resizeViewport(){const t=this.game.world.camera.fov*THREE.Math.DEG2RAD;this.height=2*Math.tan(t/2)*(this.game.world.camera.position.length()-this.distanceFromCube),this.width=this.height*this.game.world.camera.aspect;const e=1/this.game.transition.data.cameraZoom;this.width*=e,this.height*=e,this.object.position.z=this.distanceFromCube,this.object.position.y=this.height/2}}class w{constructor(t){return this.confetti=t,this.options=this.confetti.options,this.velocity=new THREE.Vector3,this.force=new THREE.Vector3,this.mesh=new THREE.Mesh(this.confetti.geometry,this.confetti.material.clone()),this.confetti.object.add(this.mesh),this.size=THREE.Math.randFloat(this.options.size.min,this.options.size.max),this.mesh.scale.set(this.size,this.size,this.size),this}reset(t=!0){this.completed=!1,this.color=new THREE.Color(this.options.colors[Math.floor(Math.random()*this.options.colors.length)]),this.mesh.material.color.set(this.color),this.speed=-1*THREE.Math.randFloat(this.options.speed.min,this.options.speed.max),this.mesh.position.x=THREE.Math.randFloat(-this.confetti.width/2,this.confetti.width/2),this.mesh.position.y=t?THREE.Math.randFloat(this.size,this.confetti.height+this.size):this.size,this.revolutionSpeed=THREE.Math.randFloat(this.options.revolution.min,this.options.revolution.max),this.revolutionAxis=["x","y","z"][Math.floor(3*Math.random())],this.mesh.rotation.set(Math.random()*Math.PI/3,Math.random()*Math.PI/3,Math.random()*Math.PI/3)}stop(){this.completed=!0,this.confetti.completed++}update(t){this.mesh.position.y+=this.speed*t,this.mesh.rotation[this.revolutionAxis]+=this.revolutionSpeed,this.mesh.position.y<-this.confetti.height-this.size&&(this.confetti.playing?this.reset(!1):this.stop())}}class E{constructor(t){this.game=t,this.data={2:{scores:[],solves:0,best:0,worst:0},3:{scores:[],solves:0,best:0,worst:0},4:{scores:[],solves:0,best:0,worst:0},5:{scores:[],solves:0,best:0,worst:0}}}addScore(t){const e=this.data[this.game.cube.sizeGenerated];e.scores.push(t),e.solves++,e.scores.lenght>100&&e.scores.shift();let s=!1;return(t<e.best||0===e.best)&&(e.best=t,s=!0),t>e.worst&&(e.worst=t),this.game.storage.saveScores(),s}calcStats(){const t=this.game.cube.sizeGenerated,e=this.data[t];this.setStat("cube-size",`${t}<i>x</i>${t}<i>x</i>${t}`),this.setStat("total-solves",e.solves),this.setStat("best-time",this.convertTime(e.best)),this.setStat("worst-time",this.convertTime(e.worst)),this.setStat("average",this.getAverage(e.solves))}clearStats(){const t=this.game.cube.sizeGenerated;this.data[t],this.setStat("cube-size",`${t}<i>x</i>${t}<i>x</i>${t}`),this.setStat("total-solves","-"),this.setStat("best-time","-"),this.setStat("worst-time","-"),this.setStat("average","-")}setStat(t,e){0===e&&(e="-"),this.game.dom.stats.querySelector(`.stats[name="${t}"] b`).innerHTML=e}getAverage(t){const e=this.data[this.game.cube.sizeGenerated];return e.scores.length<t?0:this.convertTime(e.scores.slice(-t).reduce(((t,e)=>t+e),0)/t)}convertTime(t){if(t<=0)return 0;const e=parseInt(t/1e3%60);return parseInt(t/6e4)+":"+(e<10?"0":"")+e}}class T{constructor(t){this.game=t;const e=localStorage.getItem("theCube_version");e&&e===window.gameVersion||(this.clearGame(),this.clearPreferences(),this.migrateScores(),localStorage.setItem("theCube_version",window.gameVersion))}init(){this.loadPreferences(),this.loadScores()}loadGame(){try{if(!("true"===localStorage.getItem("theCube_playing")))throw new Error;const t=JSON.parse(localStorage.getItem("theCube_savedState")),e=parseInt(localStorage.getItem("theCube_time"));if(!t||null===e)throw new Error;if(t.size!==this.game.cube.sizeGenerated)throw new Error;this.game.cube.loadFromData(t),this.game.timer.deltaTime=e,this.game.saved=!0}catch(t){this.game.saved=!1}}saveGame(){const t={names:[],positions:[],rotations:[]},e=this.game.timer.deltaTime;t.size=this.game.cube.sizeGenerated,this.game.cube.pieces.forEach((e=>{t.names.push(e.name),t.positions.push(e.position),t.rotations.push(e.rotation.toVector3())})),localStorage.setItem("theCube_playing",!0),localStorage.setItem("theCube_savedState",JSON.stringify(t)),localStorage.setItem("theCube_time",e)}clearGame(){localStorage.removeItem("theCube_playing"),localStorage.removeItem("theCube_savedState"),localStorage.removeItem("theCube_time")}loadScores(){try{const t=JSON.parse(localStorage.getItem("theCube_scores"));if(!t)throw new Error;this.game.scores.data=t}catch(t){}}saveScores(){const t=this.game.scores.data;localStorage.setItem("theCube_scores",JSON.stringify(t))}clearScores(){localStorage.removeItem("theCube_scores")}migrateScores(){try{const t=JSON.parse(localStorage.getItem("theCube_scoresData")),e=parseInt(localStorage.getItem("theCube_scoresBest")),s=parseInt(localStorage.getItem("theCube_scoresWorst")),i=parseInt(localStorage.getItem("theCube_scoresSolves"));if(!(t&&e&&i&&s))return!1;this.game.scores.data[3].scores=t,this.game.scores.data[3].best=e,this.game.scores.data[3].solves=i,this.game.scores.data[3].worst=s,localStorage.removeItem("theCube_scoresData"),localStorage.removeItem("theCube_scoresBest"),localStorage.removeItem("theCube_scoresWorst"),localStorage.removeItem("theCube_scoresSolves")}catch(t){}}loadPreferences(){try{const t=JSON.parse(localStorage.getItem("theCube_preferences"));if(!t)throw new Error;return this.game.cube.size=parseInt(t.cubeSize),this.game.controls.flipConfig=parseInt(t.flipConfig),this.game.scrambler.dificulty=parseInt(t.dificulty),this.game.world.fov=parseFloat(t.fov),this.game.world.resize(),this.game.themes.colors=t.colors,this.game.themes.setTheme(t.theme),!0}catch(t){return this.game.cube.size=3,this.game.controls.flipConfig=0,this.game.scrambler.dificulty=1,this.game.world.fov=10,this.game.world.resize(),this.game.themes.setTheme("cube"),this.savePreferences(),!1}}savePreferences(){const t={cubeSize:this.game.cube.size,flipConfig:this.game.controls.flipConfig,dificulty:this.game.scrambler.dificulty,fov:this.game.world.fov,theme:this.game.themes.theme,colors:this.game.themes.colors};localStorage.setItem("theCube_preferences",JSON.stringify(t))}clearPreferences(){localStorage.removeItem("theCube_preferences")}}class x{constructor(t){this.game=t,this.theme=null,this.defaults={cube:{U:16775167,D:16772936,F:15677731,R:4303560,B:16747530,L:8571448,P:528410,G:13751771},erno:{U:16777215,D:16766208,F:12852794,R:20922,B:16734208,L:40544,P:528410,G:9092607},dust:{U:16774891,D:15189133,F:9381182,R:6323817,B:12480354,L:8691549,P:528410,G:15189133},camo:{U:16774891,D:12564082,F:3613724,R:7439446,B:8411185,L:3621661,P:528410,G:12564082},rain:{U:16448255,D:15579437,F:13508917,R:4496009,B:15489071,L:10725703,P:528410,G:8894892}},this.colors=JSON.parse(JSON.stringify(this.defaults))}getColors(){return this.colors[this.theme]}setTheme(t=!1,e=!1){if(t===this.theme&&!1===e)return;!1!==t&&(this.theme=t);const s=this.getColors();this.game.dom.prefs.querySelectorAll(".range__handle div").forEach((t=>{t.style.background="#"+s.R.toString(16).padStart(6,"0")})),this.game.cube.updateColors(s),this.game.confetti.updateColors(s),this.game.dom.back.style.background="#"+s.G.toString(16).padStart(6,"0")}}class M{constructor(t){this.game=t,this.editColor="R",this.getPieceColor=this.getPieceColor.bind(this)}colorFromHSL(t,e,s){return t=Math.round(t),e=Math.round(e),s=Math.round(s),new THREE.Color(`hsl(${t}, ${e}%, ${s}%)`)}setHSL(t=null,e=!1){this.editColor=null===t?"R":t;const s=new THREE.Color(this.game.themes.getColors()[this.editColor]),{h:i,s:o,l:a}=s.getHSL(s),{hue:h,saturation:n,lightness:l}=this.game.preferences.ranges;if(e){const t=h.value/360,e=n.value/100,m=l.value/100,u=this.colorFromHSL(h.value,n.value,l.value);this.tweenHSL&&this.tweenHSL.stop(),this.tweenHSL=new c({duration:200,easing:r.Out(),onUpdate:r=>{h.setValue(360*(t+(i-t)*r.value)),n.setValue(100*(e+(o-e)*r.value)),l.setValue(100*(m+(a-m)*r.value));const c=u.clone().lerp(s,r.value),d=c.getStyle(),g=c.getHSL(c);h.handle.style.color=d,n.handle.style.color=d,l.handle.style.color=d,n.track.style.color=this.colorFromHSL(360*g.h,100,50).getStyle(),l.track.style.color=this.colorFromHSL(360*g.h,100*g.s,50).getStyle(),this.game.dom.theme.style.display="none",this.game.dom.theme.offsetHeight,this.game.dom.theme.style.display=""},onComplete:()=>{this.updateHSL(),this.game.storage.savePreferences()}})}else h.setValue(360*i),n.setValue(100*o),l.setValue(100*a),this.updateHSL(),this.game.storage.savePreferences()}updateHSL(){const{hue:t,saturation:e,lightness:s}=this.game.preferences.ranges,i=t.value,o=e.value,a=s.value,r=this.colorFromHSL(i,o,a).getStyle();t.handle.style.color=r,e.handle.style.color=r,s.handle.style.color=r,e.track.style.color=this.colorFromHSL(i,100,50).getStyle(),s.track.style.color=this.colorFromHSL(i,o,50).getStyle(),this.game.dom.theme.style.display="none",this.game.dom.theme.offsetHeight,this.game.dom.theme.style.display="";const h=this.game.themes.theme;this.game.themes.colors[h][this.editColor]=this.colorFromHSL(i,o,a).getHex(),this.game.themes.setTheme()}colorPicker(t){t?this.game.dom.game.addEventListener("click",this.getPieceColor,!1):this.game.dom.game.removeEventListener("click",this.getPieceColor,!1)}getPieceColor(t){const e=t.touches?t.touches[0]||t.changedTouches[0]:t,s=new THREE.Vector2(e.pageX,e.pageY);let i=this.game.controls.getIntersect(s,this.game.cube.edges,!0),o=this.game.controls.getIntersect(s,this.game.cube.cubes,!0);if(!1!==i){const t=i.object,e=t.parent.localToWorld(t.position.clone()).sub(this.game.cube.object.position).sub(this.game.cube.animator.position),s=this.game.controls.getMainAxis(e);e.multiplyScalar(2).round()[s]<1&&(i=!1)}const a=i?i.object.name:o?"P":"G";this.setHSL(a,!0)}resetTheme(){this.game.themes.colors[this.game.themes.theme]=JSON.parse(JSON.stringify(this.game.themes.defaults[this.game.themes.theme])),this.game.themes.setTheme(),this.setHSL(this.editColor,!0)}}const S={3:{checkerboard:{names:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],positions:[{x:1/3,y:-1/3,z:1/3},{x:-1/3,y:1/3,z:0},{x:1/3,y:-1/3,z:-1/3},{x:-1/3,y:0,z:-1/3},{x:1/3,y:0,z:0},{x:-1/3,y:0,z:1/3},{x:1/3,y:1/3,z:1/3},{x:-1/3,y:-1/3,z:0},{x:1/3,y:1/3,z:-1/3},{x:0,y:1/3,z:-1/3},{x:0,y:-1/3,z:0},{x:0,y:1/3,z:1/3},{x:0,y:0,z:1/3},{x:0,y:0,z:0},{x:0,y:0,z:-1/3},{x:0,y:-1/3,z:-1/3},{x:0,y:1/3,z:0},{x:0,y:-1/3,z:1/3},{x:-1/3,y:-1/3,z:1/3},{x:1/3,y:1/3,z:0},{x:-1/3,y:-1/3,z:-1/3},{x:1/3,y:0,z:-1/3},{x:-1/3,y:0,z:0},{x:1/3,y:0,z:1/3},{x:-1/3,y:1/3,z:1/3},{x:1/3,y:-1/3,z:0},{x:-1/3,y:1/3,z:-1/3}],rotations:[{x:-Math.PI,y:0,z:Math.PI},{x:Math.PI,y:0,z:0},{x:-Math.PI,y:0,z:Math.PI},{x:0,y:0,z:0},{x:0,y:0,z:Math.PI},{x:0,y:0,z:0},{x:-Math.PI,y:0,z:Math.PI},{x:Math.PI,y:0,z:0},{x:-Math.PI,y:0,z:Math.PI},{x:0,y:0,z:Math.PI},{x:0,y:0,z:0},{x:0,y:0,z:Math.PI},{x:-Math.PI,y:0,z:0},{x:Math.PI,y:0,z:Math.PI},{x:Math.PI,y:0,z:0},{x:0,y:0,z:Math.PI},{x:0,y:0,z:0},{x:0,y:0,z:Math.PI},{x:Math.PI,y:0,z:Math.PI},{x:-Math.PI,y:0,z:0},{x:Math.PI,y:0,z:Math.PI},{x:0,y:0,z:0},{x:0,y:0,z:Math.PI},{x:0,y:0,z:0},{x:Math.PI,y:0,z:Math.PI},{x:-Math.PI,y:0,z:0},{x:Math.PI,y:0,z:Math.PI}],size:3}}};new class{constructor(t){if(t=Object.assign({tagName:"icon",className:"icon",styles:!1,icons:{},observe:!1,convert:!1},t||{}),this.tagName=t.tagName,this.className=t.className,this.icons=t.icons,this.svgTag=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgTag.setAttribute("class",this.className),t.styles&&this.addStyles(),t.convert&&this.convertAllIcons(),t.observe){const t=window.MutationObserver||window.WebKitMutationObserver;this.observer=new t((t=>{this.convertAllIcons()})),this.observer.observe(document.documentElement,{childList:!0,subtree:!0})}return this}convertAllIcons(){document.querySelectorAll(this.tagName).forEach((t=>{this.convertIcon(t)}))}convertIcon(t){const e=this.icons[t.attributes[0].localName];if(void 0===e)return;const s=this.svgTag.cloneNode(!0),i=e.viewbox.split(" ");s.setAttributeNS(null,"viewBox",e.viewbox),s.style.width=i[2]/i[3]+"em",s.style.height="1em",s.innerHTML=e.content,t.parentNode.replaceChild(s,t)}addStyles(){const t=document.createElement("style");t.innerHTML=`.${this.className} { display: inline-block; font-size: inherit; overflow: visible; vertical-align: -0.125em; preserveAspectRatio: none; }`,document.head.appendChild(t)}}({icons:{settings:{viewbox:"0 0 512 512",content:'<path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z" />'},back:{viewbox:"0 0 512 512",content:'<path transform="translate(512, 0) scale(-1,1)" fill="currentColor" d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z" />'},trophy:{viewbox:"0 0 576 512",content:'<path fill="currentColor" d="M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 66.5 77.9 131.7 171.9 142.4C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6C498.4 275.6 576 210.3 576 144V88c0-13.3-10.7-24-24-24zM64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-47.5-16.4-77-49.9-77-70.2zm448 0c0 20.2-29.4 53.8-77 70.2 7-25 11.8-53.6 12.8-86.2H512v16zm-127.3 4.7l-39.6 38.6 9.4 54.6c1.7 9.8-8.7 17.2-17.4 12.6l-49-25.8-49 25.8c-8.8 4.6-19.1-2.9-17.4-12.6l9.4-54.6-39.6-38.6c-7.1-6.9-3.2-19 6.7-20.5l54.8-8 24.5-49.6c4.4-8.9 17.1-8.9 21.5 0l24.5 49.6 54.8 8c9.6 1.5 13.5 13.6 6.4 20.5z" />'},cancel:{viewbox:"0 0 352 512",content:'<path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z" />'},theme:{viewbox:"0 0 512 512",content:'<path fill="currentColor" d="M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"/>'},reset:{viewbox:"0 0 512 512",content:'<path fill="currentColor" d="M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z" />'},trash:{viewbox:"0 0 448 512",content:'<path fill="currentColor" d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z" />'}},convert:!0});const z=0,C=1,H=2,I=3,L=4,P=5,R=["stats","prefs"],A=["back","resetcube"],D=[],_=["back","clearscore"],V=["back","theme","musicico"],O=["back","reset"],k=[],j=!0,F=!1;window.game=new class{constructor(){this.dom={ui:document.querySelector(".ui"),game:document.querySelector(".ui__game"),back:document.querySelector(".ui__background"),prefs:document.querySelector(".ui__prefs"),theme:document.querySelector(".ui__theme"),stats:document.querySelector(".ui__stats"),texts:{title:document.querySelector(".text--title"),note:document.querySelector(".text--note"),timer:document.querySelector(".text--timer"),complete:document.querySelector(".text--complete"),best:document.querySelector(".text--best-time"),theme:document.querySelector(".text--theme")},buttons:{prefs:document.querySelector(".btn--prefs"),back:document.querySelector(".btn--back"),stats:document.querySelector(".btn--stats"),reset:document.querySelector(".btn--reset"),theme:document.querySelector(".btn--theme"),resetcube:document.querySelector(".btn--resetcube"),clearscore:document.querySelector(".btn--clearscore"),musicico:document.querySelector(".btn--musicico")}},this.world=new s(this),this.cube=new o(this),this.controls=new m(this),this.scrambler=new u(this),this.transition=new d(this),this.timer=new g(this),this.preferences=new v(this),this.scores=new E(this),this.storage=new T(this),this.confetti=new y(this),this.themes=new x(this),this.themeEditor=new M(this),this.initActions(),this.state=z,this.newGame=!1,this.saved=!1,this.storage.init(),this.preferences.init(),this.cube.init(),this.transition.init(),this.storage.loadGame(),this.scores.calcStats(),setTimeout((()=>{this.transition.float(),this.transition.cube(j),setTimeout((()=>this.transition.title(j)),0),setTimeout((()=>this.transition.buttons(R,k)),500)}),500)}initActions(){let t=!1;this.dom.game.addEventListener("click",(e=>{if(!(this.transition.activeTransitions>0)&&this.state!==C)if(this.state===z){if(!t)return t=!0,setTimeout((()=>t=!1),300),!1;this.game(j)}else this.state===H?this.complete(F):this.state===I&&this.stats(F)}),!1),this.controls.onMove=()=>{this.newGame&&(this.timer.start(!0),this.newGame=!1)},this.dom.buttons.back.onclick=t=>{this.transition.activeTransitions>0||(this.state===C?this.game(F):this.state===L?this.prefs(F):this.state===P?this.theme(F):this.state===I&&this.stats(F))},this.dom.buttons.reset.onclick=t=>{this.state===P&&this.themeEditor.resetTheme()},this.dom.buttons.resetcube.onclick=t=>{window.confirm("注意：还原后时间照常流逝，再次打乱并还原之后视为成功还原！")&&(this.cube.reset(),this.cube.init())},this.dom.buttons.clearscore.onclick=t=>{window.confirm("确定要清除成绩数据吗？")&&this.scores.clearStats()};var e=document.getElementById("music"),s=document.getElementById("musicimg"),i=!1;s.style="animation-play-state: paused",this.dom.buttons.musicico.onclick=t=>{0==i?(e.play(),i=!0,s.style="animation-play-state: running"):(e.pause(),i=!1,s.style="animation-play-state: paused")},this.dom.buttons.prefs.onclick=t=>this.prefs(j),this.dom.buttons.theme.onclick=t=>this.theme(j),this.dom.buttons.stats.onclick=t=>this.stats(j),this.controls.onSolved=()=>this.complete(j)}game(t){t?(this.saved||(this.scrambler.scramble(),this.controls.scrambleCube(),this.newGame=!0),!this.saved&&(this.scrambler.converted.length,this.controls.flipSpeeds[0]),this.state=C,this.saved=!0,this.transition.buttons(k,R),this.transition.title(F),setTimeout((()=>{this.transition.timer(j),this.transition.buttons(A,k)}),this.transition.durations.zoom-1e3),setTimeout((()=>{this.controls.enable(),this.newGame||this.timer.start(!0)}),this.transition.durations.zoom)):(this.state=z,this.transition.buttons(R,A),this.transition.zoom(z,0),this.controls.disable(),this.newGame||this.timer.stop(),this.transition.timer(F),setTimeout((()=>this.transition.title(j)),this.transition.durations.zoom-1e3),this.playing=!1,this.controls.disable())}prefs(t){if(t){if(this.transition.activeTransitions>0)return;this.state=L,this.transition.buttons(V,R),this.transition.title(F),this.transition.cube(F),setTimeout((()=>this.transition.preferences(j)),500)}else this.cube.resize(),this.state=z,this.transition.buttons(R,V),this.transition.preferences(F),setTimeout((()=>this.transition.cube(j)),500),setTimeout((()=>this.transition.title(j)),1200)}theme(t){if(this.themeEditor.colorPicker(t),t){if(this.transition.activeTransitions>0)return;this.cube.loadFromData(S[3].checkerboard),this.themeEditor.setHSL(null,!1),this.state=P,this.transition.buttons(O,V),this.transition.preferences(F),setTimeout((()=>this.transition.cube(j,!0)),500),setTimeout((()=>this.transition.theming(j)),1e3)}else this.state=L,this.transition.buttons(V,O),this.transition.cube(F,!0),this.transition.theming(F),setTimeout((()=>this.transition.preferences(j)),1e3),setTimeout((()=>{const t=JSON.parse(localStorage.getItem("theCube_savedState"));t?this.cube.loadFromData(t):this.cube.resize(!0)}),1500)}stats(t){if(t){if(this.transition.activeTransitions>0)return;this.state=I,this.transition.buttons(_,R),this.transition.title(F),this.transition.cube(F),setTimeout((()=>this.transition.stats(j)),500)}else this.state=z,this.transition.buttons(R,_),this.transition.stats(F),setTimeout((()=>this.transition.cube(j)),500),setTimeout((()=>this.transition.title(j)),1200)}complete(t){if(!t)return this.state=I,this.saved=!1,this.transition.timer(F),this.transition.complete(F,this.bestTime),this.transition.cube(F),this.timer.reset(),setTimeout((()=>{this.cube.reset(),this.confetti.stop(),this.transition.stats(j),this.transition.elevate(0)}),1e3),!1;this.transition.buttons(D,A),this.state=H,this.saved=!1,this.controls.disable(),this.timer.stop(),this.storage.clearGame(),this.bestTime=this.scores.addScore(this.timer.deltaTime),this.transition.zoom(z,0),this.transition.elevate(j),setTimeout((()=>{this.transition.complete(j,this.bestTime),this.confetti.start()}),1e3)}}}();
//# sourceMappingURL=cube.js.map
